# Децентрализованная система голосования (Scaffold-ETH 2)

Учебный проект на базе Scaffold-ETH 2. Реализовано on-chain голосование с веб-интерфейсом: администратор создаёт опрос, пользователи голосуют один раз, владелец может завершить голосование, фронтенд показывает вопрос, варианты и результаты в реальном времени.

## Архитектура
- **Смарт-контракт** `packages/hardhat/contracts/Voting.sol`  
  - Владелец (адрес из конструктора) создаёт опрос `createVoting(question, options)`.  
  - Голосование активно, пока владелец не вызовет `endVoting()`.  
  - Каждый адрес может проголосовать один раз за опрос (трек по `currentPollId`/`lastVotedPoll`).  
  - `getResults()` возвращает вопрос, варианты, массив голосов и статус активности.  
- **Деплой** `packages/hardhat/deploy/00_deploy_voting.ts`  
  - Разворачивает Voting и создаёт дефолтный опрос “Какой стек для web3 вы предпочитаете?”.
- **Фронтенд** `packages/nextjs/app/page.tsx`  
  - Подключение кошелька через кастомный RainbowKit.  
  - Отображение вопроса, вариантов, прогресс-баров, статуса.  
  - Кнопка “Голосовать” (доступна один раз на адрес при активном опросе).  
  - Кнопка “Завершить голосование” доступна только владельцу.  
- **Тесты** `packages/hardhat/test/Voting.ts`  
  - Запрет двойного голосования.  
  - Запрет голосования после завершения.  
  - Корректный подсчёт голосов.

## Быстрый старт (локально)
Требования: Node 20+, Yarn, Git.

1) Запустить локальную сеть:  
```bash
yarn chain
```
2) В другом терминале задеплоить контракт и создать дефолтный опрос:  
```bash
cd packages/hardhat
yarn deploy
```
3) Запустить фронтенд:  
```bash
cd ../nextjs
yarn dev
```
4) Открыть `http://localhost:3000`. Подключить кошелёк через “Connect Wallet” (RainbowKit предложит переключиться на hardhat-сеть, chainId 31337). Нажать “Голосовать” напротив нужного варианта и подтвердить транзакцию в кошельке. Если адрес — владелец, можно нажать “Завершить голосование”.

## Тесты
Юнит-тесты Hardhat:  
```bash
cd packages/hardhat
yarn test
```

## Что сделано
- Написан контракт Voting: логика создания опроса, единичного голоса на опрос, завершения и выдачи результатов.
- Деплой-скрипт создаёт стартовый опрос после развёртывания.
- Фронтенд переписан под голосование: отображение состояния, голосование, завершение владельцем, прогресс-бар результатов.
- Добавлены тесты на ключевые инварианты (двойное голосование, голосование после завершения, корректный подсчёт).

## Полезные команды
- Локальная сеть: `yarn chain`
- Деплой: `cd packages/hardhat && yarn deploy`
- Тесты: `cd packages/hardhat && yarn test`
- Фронтенд: `cd packages/nextjs && yarn dev`
